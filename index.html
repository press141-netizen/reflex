<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reflex - Designer's Archive</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Outfit', sans-serif; background: linear-gradient(180deg, #FAFBFC 0%, #F5F7FA 50%, #EEF2F7 100%); min-height: 100vh; }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useMemo, useEffect, useRef } = React;

    const TYPES = [
      { id: 'all', name: 'All', emoji: '✦' },
      { id: 'website', name: 'Website', emoji: '◎' },
      { id: 'component', name: 'Component', emoji: '◫' },
    ];

    const CATEGORIES = {
      website: [
        { id: 'all', name: 'All', emoji: '✦' },
        { id: 'landing', name: 'Landing', emoji: '◎' },
        { id: 'portfolio', name: 'Portfolio', emoji: '◐' },
        { id: 'ecommerce', name: 'E-commerce', emoji: '◈' },
        { id: 'dashboard', name: 'Dashboard', emoji: '▣' },
        { id: 'blog', name: 'Blog', emoji: '▤' },
        { id: 'corporate', name: 'Corporate', emoji: '◧' },
      ],
      component: [
        { id: 'all', name: 'All', emoji: '✦' },
        { id: 'navigation', name: 'Navigation', emoji: '☰' },
        { id: 'hero', name: 'Hero', emoji: '◐' },
        { id: 'button', name: 'Button', emoji: '▢' },
        { id: 'card', name: 'Card', emoji: '▣' },
        { id: 'form', name: 'Form', emoji: '▤' },
        { id: 'modal', name: 'Modal', emoji: '◳' },
        { id: 'sidebar', name: 'Sidebar', emoji: '◧' },
      ],
    };

    // 새로운 데이터 구조: images 배열 (각 이미지별 note, figmaCode)
    const DEFAULT_REFERENCES = [
      {
        id: 1,
        type: 'website',
        title: 'Linear Homepage',
        url: 'https://linear.app',
        images: [
          { id: 'img1', src: 'https://images.unsplash.com/photo-1618005182384-a83a8bd57fbe?w=600&h=400&fit=crop', note: '메인 히어로 섹션', figmaCode: null },
        ],
        category: 'landing',
        tags: ['minimal', 'dark', 'saas'],
        addedAt: '2024.12.15',
      },
      {
        id: 2,
        type: 'component',
        title: 'Glass Navigation',
        url: 'https://vercel.com',
        images: [
          { id: 'img2', src: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=600&h=400&fit=crop', note: '블러 효과 네비게이션', figmaCode: null },
        ],
        category: 'navigation',
        tags: ['glassmorphism', 'blur'],
        addedAt: '2024.12.12',
      },
    ];

    function App() {
      const [references, setReferences] = useState(() => {
        const saved = localStorage.getItem('reflex-references-v2');
        if (saved) {
          try {
            const parsed = JSON.parse(saved);
            // 구 데이터 마이그레이션
            return parsed.map(ref => {
              if (ref.thumbnail && !ref.images) {
                return {
                  ...ref,
                  images: [{ id: 'migrated', src: ref.thumbnail, note: ref.note || '', figmaCode: ref.figmaCode || null }],
                };
              }
              return ref;
            });
          } catch { return DEFAULT_REFERENCES; }
        }
        return DEFAULT_REFERENCES;
      });
      
      const [activeType, setActiveType] = useState('all');
      const [activeCategory, setActiveCategory] = useState('all');
      const [searchQuery, setSearchQuery] = useState('');
      const [selectedTags, setSelectedTags] = useState([]);
      const [selectedRef, setSelectedRef] = useState(null);
      const [selectedImageIndex, setSelectedImageIndex] = useState(0);
      const [isAddModalOpen, setIsAddModalOpen] = useState(false);
      const [isEditModalOpen, setIsEditModalOpen] = useState(false);
      const [editRef, setEditRef] = useState(null);
      const [imageZoom, setImageZoom] = useState(null);
      const [isGenerating, setIsGenerating] = useState(null); // 이미지 ID
      const [tagInput, setTagInput] = useState('');
      const [showTagSuggestions, setShowTagSuggestions] = useState(false);
      
      const [newRef, setNewRef] = useState({
        type: 'website',
        title: '',
        url: '',
        images: [], // { id, src, note, figmaCode }
        category: 'landing',
        tags: [],
      });

      // Save to localStorage
      useEffect(() => {
        localStorage.setItem('reflex-references-v2', JSON.stringify(references));
      }, [references]);

      // 전체 태그 목록
      const allTags = useMemo(() => {
        const tags = new Set();
        references.forEach(ref => ref.tags?.forEach(tag => tags.add(tag)));
        return Array.from(tags).sort();
      }, [references]);

      // 필터링
      const filteredReferences = useMemo(() => {
        return references.filter(ref => {
          if (activeType !== 'all' && ref.type !== activeType) return false;
          if (activeCategory !== 'all' && ref.category !== activeCategory) return false;
          if (searchQuery) {
            const q = searchQuery.toLowerCase();
            if (!ref.title.toLowerCase().includes(q) && !ref.tags?.some(t => t.toLowerCase().includes(q))) return false;
          }
          if (selectedTags.length > 0 && !selectedTags.every(t => ref.tags?.includes(t))) return false;
          return true;
        });
      }, [references, activeType, activeCategory, searchQuery, selectedTags]);

      // 이미지 업로드 핸들러
      const handleImageUpload = (e, isEdit = false) => {
        const files = Array.from(e.target.files || []);
        files.forEach(file => {
          if (file.type.startsWith('image/')) {
            const reader = new FileReader();
            reader.onload = (ev) => {
              const newImage = {
                id: Date.now() + Math.random().toString(36).substr(2, 9),
                src: ev.target.result,
                note: '',
                figmaCode: null,
              };
              if (isEdit && editRef) {
                setEditRef(prev => ({ ...prev, images: [...prev.images, newImage] }));
              } else {
                setNewRef(prev => ({ ...prev, images: [...prev.images, newImage] }));
              }
            };
            reader.readAsDataURL(file);
          }
        });
      };

      // 이미지 삭제
      const handleRemoveImage = (imgId, isEdit = false) => {
        if (isEdit) {
          setEditRef(prev => ({ ...prev, images: prev.images.filter(img => img.id !== imgId) }));
        } else {
          setNewRef(prev => ({ ...prev, images: prev.images.filter(img => img.id !== imgId) }));
        }
      };

      // 이미지 노트 수정
      const handleImageNoteChange = (imgId, note, isEdit = false) => {
        if (isEdit) {
          setEditRef(prev => ({
            ...prev,
            images: prev.images.map(img => img.id === imgId ? { ...img, note } : img)
          }));
        } else {
          setNewRef(prev => ({
            ...prev,
            images: prev.images.map(img => img.id === imgId ? { ...img, note } : img)
          }));
        }
      };

      // 태그 추가
      const handleAddTag = (tag, isEdit = false) => {
        const trimmed = tag.trim().toLowerCase();
        if (!trimmed) return;
        if (isEdit) {
          if (!editRef.tags.includes(trimmed)) {
            setEditRef(prev => ({ ...prev, tags: [...prev.tags, trimmed] }));
          }
        } else {
          if (!newRef.tags.includes(trimmed)) {
            setNewRef(prev => ({ ...prev, tags: [...prev.tags, trimmed] }));
          }
        }
        setTagInput('');
        setShowTagSuggestions(false);
      };

      // 태그 제거
      const handleRemoveTag = (tag, isEdit = false) => {
        if (isEdit) {
          setEditRef(prev => ({ ...prev, tags: prev.tags.filter(t => t !== tag) }));
        } else {
          setNewRef(prev => ({ ...prev, tags: prev.tags.filter(t => t !== tag) }));
        }
      };

      // 태그 제안 필터
      const filteredTagSuggestions = useMemo(() => {
        if (!tagInput) return allTags.slice(0, 10);
        return allTags.filter(t => t.includes(tagInput.toLowerCase())).slice(0, 10);
      }, [tagInput, allTags]);

      // 레퍼런스 추가
      const handleAddReference = () => {
        if (!newRef.title || newRef.images.length === 0) {
          alert('제목과 최소 1개의 이미지가 필요합니다.');
          return;
        }
        
        const reference = {
          id: Date.now(),
          ...newRef,
          addedAt: new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\. /g, '.').replace('.', ''),
        };
        
        setReferences(prev => [reference, ...prev]);
        setIsAddModalOpen(false);
        setNewRef({ type: 'website', title: '', url: '', images: [], category: 'landing', tags: [] });
      };

      // 레퍼런스 수정 저장
      const handleSaveEdit = () => {
        if (!editRef.title) return;
        setReferences(prev => prev.map(ref => ref.id === editRef.id ? editRef : ref));
        setSelectedRef(editRef);
        setIsEditModalOpen(false);
      };

      // 레퍼런스 삭제
      const handleDeleteReference = (id) => {
        setReferences(prev => prev.filter(ref => ref.id !== id));
        setSelectedRef(null);
      };

      // Figma 코드 생성 (특정 이미지)
      const handleGenerateFigma = async (refId, imgId) => {
        const ref = references.find(r => r.id === refId);
        const img = ref?.images.find(i => i.id === imgId);
        if (!img) return;

        setIsGenerating(imgId);
        
        try {
          let base64Data = img.src;
          let mimeType = 'image/png';
          
          if (img.src.startsWith('data:')) {
            const [header, data] = img.src.split(',');
            mimeType = header.match(/data:(.*?);/)?.[1] || 'image/png';
            base64Data = data;
          } else {
            // URL인 경우 fetch
            const response = await fetch(img.src);
            const blob = await response.blob();
            mimeType = blob.type;
            base64Data = await new Promise(resolve => {
              const reader = new FileReader();
              reader.onload = () => resolve(reader.result.split(',')[1]);
              reader.readAsDataURL(blob);
            });
          }

          // 이미지 크기
          const imgEl = new Image();
          imgEl.src = img.src;
          await new Promise(resolve => { imgEl.onload = resolve; });

          const apiResponse = await fetch('/api/analyze', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              image: base64Data,
              mimeType,
              componentName: ref.title,
              imageWidth: imgEl.naturalWidth,
              imageHeight: imgEl.naturalHeight,
            }),
          });

          if (!apiResponse.ok) throw new Error('API failed');
          
          const result = await apiResponse.json();
          
          if (result.figmaCode) {
            setReferences(prev => prev.map(r => {
              if (r.id !== refId) return r;
              return {
                ...r,
                images: r.images.map(i => i.id === imgId ? { ...i, figmaCode: result.figmaCode } : i)
              };
            }));
            // 현재 선택된 ref 업데이트
            if (selectedRef?.id === refId) {
              setSelectedRef(prev => ({
                ...prev,
                images: prev.images.map(i => i.id === imgId ? { ...i, figmaCode: result.figmaCode } : i)
              }));
            }
          }
        } catch (error) {
          console.error('Figma 생성 실패:', error);
          alert('Figma 코드 생성에 실패했습니다.');
        } finally {
          setIsGenerating(null);
        }
      };

      // 클립보드 복사
      const copyToClipboard = (code) => {
        navigator.clipboard.writeText(code);
      };

      return (
        <div style={styles.container}>
          {/* Header */}
          <header style={styles.header}>
            <div style={styles.headerInner}>
              <div style={styles.logo}>
                <span style={styles.logoIcon}>◈</span>
                <span style={styles.logoText}>Reflex</span>
              </div>
              <button style={styles.addButton} onClick={() => setIsAddModalOpen(true)}>
                + Add Reference
              </button>
            </div>
          </header>

          {/* Filters */}
          <section style={styles.filterSection}>
            <div style={styles.typeToggle}>
              {TYPES.map(type => (
                <button
                  key={type.id}
                  onClick={() => { setActiveType(type.id); setActiveCategory('all'); }}
                  style={{ ...styles.typeButton, ...(activeType === type.id ? styles.typeButtonActive : {}) }}
                >
                  {type.emoji} {type.name}
                </button>
              ))}
            </div>
            <input
              type="text"
              placeholder="Search..."
              value={searchQuery}
              onChange={e => setSearchQuery(e.target.value)}
              style={styles.searchInput}
            />
          </section>

          {/* Category Filter */}
          {activeType !== 'all' && (
            <div style={styles.categoryFilter}>
              {CATEGORIES[activeType]?.map(cat => (
                <button
                  key={cat.id}
                  onClick={() => setActiveCategory(cat.id)}
                  style={{ ...styles.catButton, ...(activeCategory === cat.id ? styles.catButtonActive : {}) }}
                >
                  {cat.name}
                </button>
              ))}
            </div>
          )}

          {/* Grid */}
          <main style={styles.grid}>
            {filteredReferences.map(ref => (
              <article key={ref.id} style={styles.card} onClick={() => { setSelectedRef(ref); setSelectedImageIndex(0); }}>
                <div style={styles.cardImageWrapper}>
                  <img src={ref.images[0]?.src} alt={ref.title} style={styles.cardImage} />
                  {ref.images.length > 1 && (
                    <span style={styles.imageCount}>+{ref.images.length - 1}</span>
                  )}
                  {ref.images.some(img => img.figmaCode) && (
                    <span style={styles.figmaBadge}>◫</span>
                  )}
                </div>
                <div style={styles.cardContent}>
                  <h3 style={styles.cardTitle}>{ref.title}</h3>
                  <div style={styles.cardTags}>
                    {ref.tags?.slice(0, 3).map(tag => (
                      <span key={tag} style={styles.cardTag}>#{tag}</span>
                    ))}
                  </div>
                </div>
              </article>
            ))}
          </main>

          {/* Detail Modal */}
          {selectedRef && (
            <div style={styles.modalOverlay} onClick={() => setSelectedRef(null)}>
              <div style={styles.modal} onClick={e => e.stopPropagation()}>
                <button style={styles.modalClose} onClick={() => setSelectedRef(null)}>✕</button>
                
                {/* 이미지 갤러리 */}
                <div style={styles.imageGallery}>
                  <img
                    src={selectedRef.images[selectedImageIndex]?.src}
                    alt=""
                    style={styles.modalImage}
                    onClick={() => setImageZoom(selectedRef.images[selectedImageIndex]?.src)}
                  />
                  {selectedRef.images.length > 1 && (
                    <div style={styles.imageThumbs}>
                      {selectedRef.images.map((img, idx) => (
                        <img
                          key={img.id}
                          src={img.src}
                          alt=""
                          style={{ ...styles.thumbImg, ...(idx === selectedImageIndex ? styles.thumbImgActive : {}) }}
                          onClick={() => setSelectedImageIndex(idx)}
                        />
                      ))}
                    </div>
                  )}
                </div>

                <div style={styles.modalContent}>
                  <div style={styles.modalMeta}>
                    <span style={styles.modalType}>{TYPES.find(t => t.id === selectedRef.type)?.emoji} {selectedRef.type}</span>
                    <span>•</span>
                    <span>{CATEGORIES[selectedRef.type]?.find(c => c.id === selectedRef.category)?.name}</span>
                  </div>
                  <h2 style={styles.modalTitle}>{selectedRef.title}</h2>
                  {selectedRef.url && (
                    <a href={selectedRef.url} target="_blank" style={styles.modalUrl}>{selectedRef.url} ↗</a>
                  )}
                  
                  {/* 현재 이미지 노트 */}
                  {selectedRef.images[selectedImageIndex]?.note && (
                    <p style={styles.modalNote}>{selectedRef.images[selectedImageIndex].note}</p>
                  )}

                  {/* 태그 */}
                  <div style={styles.modalTags}>
                    {selectedRef.tags?.map(tag => (
                      <span key={tag} style={styles.modalTag}>#{tag}</span>
                    ))}
                  </div>

                  {/* Figma 코드 생성/표시 */}
                  <div style={styles.figmaSection}>
                    {selectedRef.images[selectedImageIndex]?.figmaCode ? (
                      <>
                        <div style={styles.figmaHeader}>
                          <span>◫ Figma Code</span>
                          <button
                            style={styles.copyBtn}
                            onClick={() => copyToClipboard(selectedRef.images[selectedImageIndex].figmaCode)}
                          >
                            Copy
                          </button>
                        </div>
                        <pre style={styles.figmaCode}>
                          {selectedRef.images[selectedImageIndex].figmaCode.slice(0, 300)}...
                        </pre>
                      </>
                    ) : (
                      <button
                        style={{ ...styles.generateBtn, ...(isGenerating ? styles.generateBtnDisabled : {}) }}
                        onClick={() => handleGenerateFigma(selectedRef.id, selectedRef.images[selectedImageIndex].id)}
                        disabled={isGenerating}
                      >
                        {isGenerating === selectedRef.images[selectedImageIndex]?.id ? (
                          <><span style={styles.spinner}></span> Generating...</>
                        ) : (
                          '◫ Generate Figma Code'
                        )}
                      </button>
                    )}
                  </div>

                  <div style={styles.modalFooter}>
                    <span>{selectedRef.addedAt}</span>
                    <div style={styles.modalActions}>
                      <button style={styles.editBtn} onClick={() => { setEditRef({...selectedRef}); setIsEditModalOpen(true); }}>
                        ✎ Edit
                      </button>
                      <button style={styles.deleteBtn} onClick={() => handleDeleteReference(selectedRef.id)}>
                        Delete
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          )}

          {/* Add Modal */}
          {isAddModalOpen && (
            <div style={styles.modalOverlay} onClick={() => setIsAddModalOpen(false)}>
              <div style={styles.addModal} onClick={e => e.stopPropagation()}>
                <button style={styles.modalClose} onClick={() => setIsAddModalOpen(false)}>✕</button>
                <h2 style={styles.modalTitle}>Add New Reference</h2>

                {/* Type */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Type</label>
                  <div style={styles.typeToggle}>
                    <button
                      style={{ ...styles.typeButton, ...(newRef.type === 'website' ? styles.typeButtonActive : {}) }}
                      onClick={() => setNewRef(p => ({ ...p, type: 'website', category: 'landing' }))}
                    >
                      ◎ Website
                    </button>
                    <button
                      style={{ ...styles.typeButton, ...(newRef.type === 'component' ? styles.typeButtonActive : {}) }}
                      onClick={() => setNewRef(p => ({ ...p, type: 'component', category: 'navigation' }))}
                    >
                      ◫ Component
                    </button>
                  </div>
                </div>

                {/* Images */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>
                    Images {newRef.type === 'website' ? '(여러 장 가능)' : '(1장)'}
                  </label>
                  <div style={styles.imageUploadArea}>
                    {newRef.images.map(img => (
                      <div key={img.id} style={styles.uploadedImage}>
                        <img src={img.src} alt="" style={styles.uploadedThumb} />
                        <button style={styles.removeImgBtn} onClick={() => handleRemoveImage(img.id)}>✕</button>
                        <input
                          type="text"
                          placeholder="이미지 설명..."
                          value={img.note}
                          onChange={e => handleImageNoteChange(img.id, e.target.value)}
                          style={styles.imgNoteInput}
                        />
                      </div>
                    ))}
                    {(newRef.type === 'website' || newRef.images.length === 0) && (
                      <label style={styles.addImageBtn}>
                        + Add Image
                        <input
                          type="file"
                          accept="image/*"
                          multiple={newRef.type === 'website'}
                          onChange={e => handleImageUpload(e)}
                          style={{ display: 'none' }}
                        />
                      </label>
                    )}
                  </div>
                </div>

                {/* Title */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Title *</label>
                  <input
                    type="text"
                    value={newRef.title}
                    onChange={e => setNewRef(p => ({ ...p, title: e.target.value }))}
                    style={styles.input}
                    placeholder="e.g., Linear Homepage"
                  />
                </div>

                {/* URL */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>URL</label>
                  <input
                    type="url"
                    value={newRef.url}
                    onChange={e => setNewRef(p => ({ ...p, url: e.target.value }))}
                    style={styles.input}
                    placeholder="https://example.com"
                  />
                </div>

                {/* Category */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Category</label>
                  <select
                    value={newRef.category}
                    onChange={e => setNewRef(p => ({ ...p, category: e.target.value }))}
                    style={styles.select}
                  >
                    {CATEGORIES[newRef.type]?.filter(c => c.id !== 'all').map(cat => (
                      <option key={cat.id} value={cat.id}>{cat.name}</option>
                    ))}
                  </select>
                </div>

                {/* Tags */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Tags</label>
                  <div style={styles.tagsContainer}>
                    {newRef.tags.map(tag => (
                      <span key={tag} style={styles.tagChip}>
                        #{tag}
                        <button style={styles.tagRemove} onClick={() => handleRemoveTag(tag)}>×</button>
                      </span>
                    ))}
                  </div>
                  <div style={styles.tagInputWrapper}>
                    <input
                      type="text"
                      value={tagInput}
                      onChange={e => { setTagInput(e.target.value); setShowTagSuggestions(true); }}
                      onFocus={() => setShowTagSuggestions(true)}
                      onKeyDown={e => { if (e.key === 'Enter') { e.preventDefault(); handleAddTag(tagInput); } }}
                      style={styles.input}
                      placeholder="태그 입력 후 Enter"
                    />
                    {showTagSuggestions && filteredTagSuggestions.length > 0 && (
                      <div style={styles.tagSuggestions}>
                        {filteredTagSuggestions.map(tag => (
                          <button key={tag} style={styles.tagSuggestion} onClick={() => handleAddTag(tag)}>
                            #{tag}
                          </button>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                <button style={styles.submitBtn} onClick={handleAddReference}>
                  Add Reference
                </button>
              </div>
            </div>
          )}

          {/* Edit Modal */}
          {isEditModalOpen && editRef && (
            <div style={styles.modalOverlay} onClick={() => setIsEditModalOpen(false)}>
              <div style={styles.addModal} onClick={e => e.stopPropagation()}>
                <button style={styles.modalClose} onClick={() => setIsEditModalOpen(false)}>✕</button>
                <h2 style={styles.modalTitle}>Edit Reference</h2>

                {/* Type */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Type</label>
                  <div style={styles.typeToggle}>
                    <button
                      style={{ ...styles.typeButton, ...(editRef.type === 'website' ? styles.typeButtonActive : {}) }}
                      onClick={() => setEditRef(p => ({ ...p, type: 'website' }))}
                    >
                      ◎ Website
                    </button>
                    <button
                      style={{ ...styles.typeButton, ...(editRef.type === 'component' ? styles.typeButtonActive : {}) }}
                      onClick={() => setEditRef(p => ({ ...p, type: 'component' }))}
                    >
                      ◫ Component
                    </button>
                  </div>
                </div>

                {/* Images */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Images</label>
                  <div style={styles.imageUploadArea}>
                    {editRef.images.map(img => (
                      <div key={img.id} style={styles.uploadedImage}>
                        <img src={img.src} alt="" style={styles.uploadedThumb} />
                        <button style={styles.removeImgBtn} onClick={() => handleRemoveImage(img.id, true)}>✕</button>
                        <input
                          type="text"
                          placeholder="이미지 설명..."
                          value={img.note}
                          onChange={e => handleImageNoteChange(img.id, e.target.value, true)}
                          style={styles.imgNoteInput}
                        />
                      </div>
                    ))}
                    {(editRef.type === 'website' || editRef.images.length === 0) && (
                      <label style={styles.addImageBtn}>
                        + Add Image
                        <input
                          type="file"
                          accept="image/*"
                          multiple={editRef.type === 'website'}
                          onChange={e => handleImageUpload(e, true)}
                          style={{ display: 'none' }}
                        />
                      </label>
                    )}
                  </div>
                </div>

                {/* Title */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Title *</label>
                  <input
                    type="text"
                    value={editRef.title}
                    onChange={e => setEditRef(p => ({ ...p, title: e.target.value }))}
                    style={styles.input}
                  />
                </div>

                {/* URL */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>URL</label>
                  <input
                    type="url"
                    value={editRef.url || ''}
                    onChange={e => setEditRef(p => ({ ...p, url: e.target.value }))}
                    style={styles.input}
                  />
                </div>

                {/* Category */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Category</label>
                  <select
                    value={editRef.category}
                    onChange={e => setEditRef(p => ({ ...p, category: e.target.value }))}
                    style={styles.select}
                  >
                    {CATEGORIES[editRef.type]?.filter(c => c.id !== 'all').map(cat => (
                      <option key={cat.id} value={cat.id}>{cat.name}</option>
                    ))}
                  </select>
                </div>

                {/* Tags */}
                <div style={styles.formGroup}>
                  <label style={styles.label}>Tags</label>
                  <div style={styles.tagsContainer}>
                    {editRef.tags?.map(tag => (
                      <span key={tag} style={styles.tagChip}>
                        #{tag}
                        <button style={styles.tagRemove} onClick={() => handleRemoveTag(tag, true)}>×</button>
                      </span>
                    ))}
                  </div>
                  <div style={styles.tagInputWrapper}>
                    <input
                      type="text"
                      value={tagInput}
                      onChange={e => { setTagInput(e.target.value); setShowTagSuggestions(true); }}
                      onFocus={() => setShowTagSuggestions(true)}
                      onKeyDown={e => { if (e.key === 'Enter') { e.preventDefault(); handleAddTag(tagInput, true); } }}
                      style={styles.input}
                      placeholder="태그 입력 후 Enter"
                    />
                    {showTagSuggestions && filteredTagSuggestions.length > 0 && (
                      <div style={styles.tagSuggestions}>
                        {filteredTagSuggestions.map(tag => (
                          <button key={tag} style={styles.tagSuggestion} onClick={() => handleAddTag(tag, true)}>
                            #{tag}
                          </button>
                        ))}
                      </div>
                    )}
                  </div>
                </div>

                <div style={styles.editBtns}>
                  <button style={styles.cancelBtn} onClick={() => setIsEditModalOpen(false)}>Cancel</button>
                  <button style={styles.submitBtn} onClick={handleSaveEdit}>Save Changes</button>
                </div>
              </div>
            </div>
          )}

          {/* Image Zoom */}
          {imageZoom && (
            <div style={styles.zoomOverlay} onClick={() => setImageZoom(null)}>
              <img src={imageZoom} alt="" style={styles.zoomImage} />
            </div>
          )}
        </div>
      );
    }

    const styles = {
      container: { minHeight: '100vh', padding: '20px' },
      header: { maxWidth: '1400px', margin: '0 auto 30px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' },
      headerInner: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', width: '100%' },
      logo: { display: 'flex', alignItems: 'center', gap: '8px' },
      logoIcon: { fontSize: '28px', color: '#6366f1' },
      logoText: { fontSize: '24px', fontWeight: '700', fontFamily: '"Space Grotesk", sans-serif' },
      addButton: { padding: '10px 20px', background: 'linear-gradient(135deg, #6366f1, #8b5cf6)', color: '#fff', border: 'none', borderRadius: '10px', fontWeight: '600', cursor: 'pointer', fontFamily: '"Outfit", sans-serif' },
      filterSection: { maxWidth: '1400px', margin: '0 auto 20px', display: 'flex', gap: '16px', alignItems: 'center', flexWrap: 'wrap' },
      typeToggle: { display: 'flex', gap: '8px' },
      typeButton: { padding: '8px 16px', background: '#fff', border: '1px solid #e5e7eb', borderRadius: '8px', cursor: 'pointer', fontFamily: '"Outfit", sans-serif', fontSize: '14px' },
      typeButtonActive: { background: '#6366f1', color: '#fff', borderColor: '#6366f1' },
      searchInput: { padding: '10px 16px', border: '1px solid #e5e7eb', borderRadius: '8px', fontSize: '14px', width: '200px', fontFamily: '"Outfit", sans-serif' },
      categoryFilter: { maxWidth: '1400px', margin: '0 auto 20px', display: 'flex', gap: '8px', flexWrap: 'wrap' },
      catButton: { padding: '6px 12px', background: '#fff', border: '1px solid #e5e7eb', borderRadius: '6px', cursor: 'pointer', fontSize: '13px', fontFamily: '"Outfit", sans-serif' },
      catButtonActive: { background: '#f0f0ff', borderColor: '#6366f1', color: '#6366f1' },
      grid: { maxWidth: '1400px', margin: '0 auto', display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(280px, 1fr))', gap: '20px' },
      card: { background: '#fff', borderRadius: '16px', overflow: 'hidden', cursor: 'pointer', boxShadow: '0 2px 8px rgba(0,0,0,0.06)', transition: 'transform 0.2s, box-shadow 0.2s' },
      cardImageWrapper: { position: 'relative', aspectRatio: '16/10', overflow: 'hidden' },
      cardImage: { width: '100%', height: '100%', objectFit: 'cover' },
      imageCount: { position: 'absolute', top: '8px', right: '8px', background: 'rgba(0,0,0,0.6)', color: '#fff', padding: '4px 8px', borderRadius: '4px', fontSize: '12px' },
      figmaBadge: { position: 'absolute', bottom: '8px', right: '8px', background: '#6366f1', color: '#fff', padding: '4px 8px', borderRadius: '4px', fontSize: '12px' },
      cardContent: { padding: '16px' },
      cardTitle: { fontSize: '16px', fontWeight: '600', marginBottom: '8px', fontFamily: '"Space Grotesk", sans-serif' },
      cardTags: { display: 'flex', gap: '6px', flexWrap: 'wrap' },
      cardTag: { fontSize: '12px', color: '#6366f1', background: '#f0f0ff', padding: '2px 8px', borderRadius: '4px' },
      modalOverlay: { position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, padding: '20px' },
      modal: { background: '#fff', borderRadius: '20px', maxWidth: '900px', width: '100%', maxHeight: '90vh', overflow: 'auto', position: 'relative' },
      addModal: { background: '#fff', borderRadius: '20px', maxWidth: '600px', width: '100%', maxHeight: '90vh', overflow: 'auto', padding: '30px', position: 'relative' },
      modalClose: { position: 'absolute', top: '16px', right: '16px', width: '36px', height: '36px', background: '#f5f5f5', border: 'none', borderRadius: '50%', cursor: 'pointer', fontSize: '18px', zIndex: 10 },
      imageGallery: { position: 'relative' },
      modalImage: { width: '100%', maxHeight: '400px', objectFit: 'contain', background: '#f5f5f5', cursor: 'zoom-in' },
      imageThumbs: { display: 'flex', gap: '8px', padding: '12px', background: '#f9f9f9', overflowX: 'auto' },
      thumbImg: { width: '60px', height: '40px', objectFit: 'cover', borderRadius: '4px', cursor: 'pointer', opacity: 0.6, transition: 'opacity 0.2s' },
      thumbImgActive: { opacity: 1, boxShadow: '0 0 0 2px #6366f1' },
      modalContent: { padding: '24px' },
      modalMeta: { display: 'flex', gap: '8px', alignItems: 'center', color: '#888', fontSize: '14px', marginBottom: '8px' },
      modalType: { color: '#6366f1', fontWeight: '600' },
      modalTitle: { fontSize: '24px', fontWeight: '700', marginBottom: '12px', fontFamily: '"Space Grotesk", sans-serif' },
      modalUrl: { display: 'inline-block', color: '#6366f1', fontSize: '14px', marginBottom: '12px', textDecoration: 'none' },
      modalNote: { color: '#555', fontSize: '15px', lineHeight: 1.6, marginBottom: '16px', padding: '12px', background: '#f9f9f9', borderRadius: '8px' },
      modalTags: { display: 'flex', gap: '8px', flexWrap: 'wrap', marginBottom: '20px' },
      modalTag: { fontSize: '13px', color: '#6366f1', background: '#f0f0ff', padding: '4px 12px', borderRadius: '6px' },
      figmaSection: { marginBottom: '20px' },
      figmaHeader: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' },
      copyBtn: { padding: '6px 12px', background: '#6366f1', color: '#fff', border: 'none', borderRadius: '6px', cursor: 'pointer', fontSize: '12px' },
      figmaCode: { background: '#1e1e2e', color: '#a5d6ff', padding: '16px', borderRadius: '8px', fontSize: '11px', fontFamily: 'monospace', overflow: 'auto', maxHeight: '150px' },
      generateBtn: { width: '100%', padding: '14px', background: 'linear-gradient(135deg, #6366f1, #8b5cf6)', color: '#fff', border: 'none', borderRadius: '10px', fontWeight: '600', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px', fontFamily: '"Outfit", sans-serif' },
      generateBtnDisabled: { background: '#a5a6f6', cursor: 'not-allowed' },
      spinner: { width: '16px', height: '16px', border: '2px solid rgba(255,255,255,0.3)', borderTopColor: '#fff', borderRadius: '50%', animation: 'spin 0.8s linear infinite' },
      modalFooter: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', paddingTop: '16px', borderTop: '1px solid #eee' },
      modalActions: { display: 'flex', gap: '8px' },
      editBtn: { padding: '8px 16px', background: '#f0f0f5', border: 'none', borderRadius: '8px', cursor: 'pointer', fontFamily: '"Outfit", sans-serif' },
      deleteBtn: { padding: '8px 16px', background: '#fee2e2', color: '#dc2626', border: 'none', borderRadius: '8px', cursor: 'pointer', fontFamily: '"Outfit", sans-serif' },
      formGroup: { marginBottom: '20px' },
      label: { display: 'block', fontSize: '14px', fontWeight: '600', marginBottom: '8px', color: '#333' },
      input: { width: '100%', padding: '12px', border: '1px solid #e5e7eb', borderRadius: '8px', fontSize: '14px', fontFamily: '"Outfit", sans-serif' },
      select: { width: '100%', padding: '12px', border: '1px solid #e5e7eb', borderRadius: '8px', fontSize: '14px', fontFamily: '"Outfit", sans-serif' },
      imageUploadArea: { display: 'flex', flexWrap: 'wrap', gap: '12px' },
      uploadedImage: { position: 'relative', width: '120px' },
      uploadedThumb: { width: '120px', height: '80px', objectFit: 'cover', borderRadius: '8px' },
      removeImgBtn: { position: 'absolute', top: '-6px', right: '-6px', width: '20px', height: '20px', background: '#ef4444', color: '#fff', border: 'none', borderRadius: '50%', cursor: 'pointer', fontSize: '12px' },
      imgNoteInput: { width: '100%', marginTop: '4px', padding: '6px', border: '1px solid #e5e7eb', borderRadius: '4px', fontSize: '11px' },
      addImageBtn: { width: '120px', height: '80px', border: '2px dashed #d1d5db', borderRadius: '8px', display: 'flex', alignItems: 'center', justifyContent: 'center', cursor: 'pointer', color: '#9ca3af', fontSize: '13px', fontFamily: '"Outfit", sans-serif' },
      tagsContainer: { display: 'flex', flexWrap: 'wrap', gap: '8px', marginBottom: '8px' },
      tagChip: { display: 'flex', alignItems: 'center', gap: '4px', background: '#f0f0ff', color: '#6366f1', padding: '4px 10px', borderRadius: '6px', fontSize: '13px' },
      tagRemove: { background: 'none', border: 'none', color: '#6366f1', cursor: 'pointer', fontSize: '16px', padding: 0 },
      tagInputWrapper: { position: 'relative' },
      tagSuggestions: { position: 'absolute', top: '100%', left: 0, right: 0, background: '#fff', border: '1px solid #e5e7eb', borderRadius: '8px', boxShadow: '0 4px 12px rgba(0,0,0,0.1)', zIndex: 10, maxHeight: '200px', overflow: 'auto' },
      tagSuggestion: { display: 'block', width: '100%', padding: '10px 12px', border: 'none', background: 'none', textAlign: 'left', cursor: 'pointer', fontSize: '13px', fontFamily: '"Outfit", sans-serif' },
      submitBtn: { width: '100%', padding: '14px', background: 'linear-gradient(135deg, #6366f1, #8b5cf6)', color: '#fff', border: 'none', borderRadius: '10px', fontWeight: '600', cursor: 'pointer', fontSize: '15px', fontFamily: '"Outfit", sans-serif' },
      editBtns: { display: 'flex', gap: '12px' },
      cancelBtn: { flex: 1, padding: '14px', background: '#f0f0f5', border: 'none', borderRadius: '10px', cursor: 'pointer', fontFamily: '"Outfit", sans-serif' },
      zoomOverlay: { position: 'fixed', inset: 0, background: 'rgba(0,0,0,0.95)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 2000, cursor: 'zoom-out' },
      zoomImage: { maxWidth: '95vw', maxHeight: '95vh', objectFit: 'contain' },
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
