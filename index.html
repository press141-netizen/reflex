<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reflex â€“ Image to Figma</title>
</head>
<body>
<script>
/**
 * SAFETY WRAPPER
 * - Always preload fonts
 * - Force async IIFE
 * - Sanitize Inter font usage
 */
function wrapWithFontSafety(code) {
  const preload = `(async () => {
    await figma.loadFontAsync({ family: "Inter", style: "Regular" });
    await figma.loadFontAsync({ family: "Inter", style: "Medium" });
  `;

  const postload = `
  })();`;

  const sanitized = code.replace(
    /fontName\s*=\s*{\s*family:\s*["']Inter["']\s*,\s*style:\s*["'][^"']+["']\s*}/g,
    'fontName = { family: "Inter", style: "Regular" }'
  );

  return preload + sanitized + postload;
}

// Example execution hook
async function runGeneratedCode(figmaCode) {
  const safeCode = wrapWithFontSafety(figmaCode);
  eval(safeCode);
}
</script>
</body>
</html>
